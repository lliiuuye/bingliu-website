name: ç”Ÿæˆå¹¶éƒ¨ç½²ç½‘ç«™

on:
  push:
    branches: [ main ]
  workflow_dispatch: # æ‰‹åŠ¨è§¦å‘
  schedule:
    - cron: '0 8 * * *' # æ¯å¤© UTC 8:00 è‡ªåŠ¨æ‰§è¡Œ

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # ğŸ‘ˆ Add this
    steps:
    - name: è·å–ä»“åº“ä»£ç 
      uses: actions/checkout@v3

    - name: è®¾ç½® Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: å®‰è£…ä¾èµ–
      run: |
        pip install requests jinja2 selenium webdriver-manager

    - name: å®‰è£… Chromium
      run: |
        sudo apt-get update
        sudo apt-get install -y chromium-browser

    - name: è¿è¡Œ Python è„šæœ¬ç”Ÿæˆ index.html
      run: python fetch_news.py

    - name: è®¾ç½® Git ç”¨æˆ·ä¿¡æ¯å¹¶æ¨é€æ›´æ”¹
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        git remote set-url origin https://x-access-token:${{ secrets.GH_TOKEN }}@github.com/${{ github.repository }}.git
        git add .
        git commit -m "è‡ªåŠ¨ç”Ÿæˆ index.html âœ…" || echo "æ²¡æœ‰æ”¹åŠ¨"
        git push

    - name: æŸ¥çœ‹è¿œç¨‹ä»“åº“åœ°å€
      run: git remote -v

    - name: åˆ—å‡ºå·¥ä½œç›®å½•å†…å®¹
      run: ls -lah

    - name: æ£€æŸ¥ index.html æ˜¯å¦å­˜åœ¨
      run: |
        test -f public/index.html && echo "âœ… æ‰¾åˆ° index.html" || echo "âŒ æ²¡æ‰¾åˆ° index.html"
